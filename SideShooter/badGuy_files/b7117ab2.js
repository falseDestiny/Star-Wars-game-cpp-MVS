var FavoritesUtil,ImageFavorites;(function(n){function c(n){sj_evt.fire("Favorites.ToggleLearnMore",n)}var h,f;n.getHoveredElement;var u=pMMUtils,r="/",t="_IFAV",i="COUNT",e="SEEALL",s="Favorites",o=["/images/","/images"];n.instEr="CI.Error";n.instCl="CI.Click",function(n){n[n.Delete=0]="Delete";n[n.Write=1]="Write"}(n.TransactionType||(n.TransactionType={}));h=n.TransactionType,function(n){n[n.IRP=0]="IRP";n[n.Insights=1]="Insights";n[n.FavoritesPage=2]="FavoritesPage"}(n.RequestType||(n.RequestType={}));f=n.RequestType;n.rsc=function(){if(typeof removeCookie!="undefined")for(var n=0;n<o.length;n++)removeCookie(t,o[n])};n.ufcw=function(){var n=parseInt(sj_cook.get(t,i)),u=n+1;sj_cook.set(t,i,u.toString(),!0,r)};n.ufcd=function(){var n=parseInt(sj_cook.get(t,i)),u=n-1;sj_cook.set(t,i,u.toString(),!0,r)};n.ufcr=function(n){var c=_ge("ilp_fg")!=null,o=_ge(n),f,s,h;o!=null&&(f=u.ga(o,"ct"),f!=null&&sj_cook.set(t,i,f,!0,r));c&&(s=parseInt(sj_cook.get(t,e)),h=s+1,sj_cook.set(t,e,h.toString(),!0,r))};n.gmd=function(n){var i=null,t;if(n!=null&&(t=u.ga(n,"m"),t))try{i=eval("("+t+")")}catch(r){return null}return i};n.unsave=function(t,i,r,u){var e=f[i]==f[1]?r:n.gmd(t),o;if(e!=null&&e.md5!=null)return o={},o.MD5=e.md5,n.sxhr(o,0,t,i,u),n.ufcd(),!0};n.sxhr=function(n,t,i,r,u){if(n){var f={purl:n.SourceUrl,murl:n.MediaUrl,cid:n.ContentId,desc:n.description,mid:n.mid,tid:n.ThumbnailId,thW:n.ThWidth,thH:n.ThHeight,md5:n.MD5,mw:n.MediaWidth,mh:n.MediaHeight,format:n.MediaFormat,query:n.query},e=n.CollectionId?{id:n.CollectionId}:n.CollectionType?{collectionType:n.CollectionType}:n.query?{title:n.query}:{collectionType:3};switch(t){case 0:MmFaves.removeImageFromFavorites(f,u?u:function(){});break;case 1:MmFaves.addImageToFavorites(e,f,u?u:function(){})}}};n.lfi=function(n,t,i,r){pInstr.logEvent(n,t,null,s,{Component:i},r)};n.saveState=c;n.gebid=function(t,i,r){var c=_ge(i),f,e,o,s,h;if(c&&t&&(f=u.gebc(r,c),f))for(e=0;e<f.length;e++)if(o=f[e],o&&o.childNodes.length>0&&(s=o.childNodes[0],h=n.gmd(s),h&&h.mid==t))return s;return null};sj_evt.fire("FavUtils.Loaded")})(FavoritesUtil||(FavoritesUtil={})),function(n){function k(){var n=parseQueryParams();r=n.q;r!=null&&typeof r!="undefined"&&(r=decodeURIComponent(r).toLowerCase());t.ufcr("favmd");t.rsc();b=t.gmd(_ge("favmd"));f.bind(p,d);sj_be(_w,y,ut)}function d(t){t&&t.length>2&&n.hfc(t[1],t[2])}function g(n,i){if(i&&n){var r=t.gmd(i);r&&r.md5&&sj_evt.fire("Favorites.ShowMoveToBalloon",r.md5,n)}}function c(){sj_evt.fire("Favorites.HideMoveToBalloon")}function nt(n,t){n&&t&&sj_evt.fire("Favorites.ShowMoveToBalloon",n.md5,t)}function l(n){switch(n){case"can_fav_icon":return"ImageCanvas";case"mb_fav":return"ImageViewer";default:return"Insights"}}function it(n){pMMUtils.ac(n,"fade")}function rt(){var n=parseQueryParams();return n.iss=="rec"?1:0}function ut(n){var i=MMMessenger.GetMessageData(n),r,u;i&&(r=i.data,r&&r.mid&&(u=t.gebid(r.mid,"vm_c","dg_u"),u&&(i.command==="Favorite.Add"?a(u):i.command==="Favorite.Remove"&&e(u))))}var i=pMMUtils,r="",y="message",p="Favorites.HoverHeartClick",u="saved",t=FavoritesUtil,f=sj_evt,w="/s/mm/favorite_yellow_13.png",s="tooltip",h="FavoritesStatusChanged",b=null,e,v,o;n.hfc=function(t,i){return n.hfcc(t,i)};n.hfcc=function(n,i){if(n==null||i==null||n.parentNode==null||i.parentNode==null||i.parentNode.parentNode==null){t.lfi(null,t.instEr,"HoverClick");return}var u=tt(i),r=t.gmd(i);r!=null?u?(t.lfi(r.ns,t.instCl,"HoverRemove"),t.unsave(i,0),e(i),f.fire("Favorites.UpdateStatus",!1,n),c()):(t.lfi(r.ns,t.instCl,"HoverAdd"),o(i,0),g(n,i),a(i),f.fire("Favorites.UpdateStatus",!0,n)):t.lfi(r.ns,t.instEr,"HoverClick")};n.iffbc=function(){if(typeof FavNsiCook!="undefined"){var n=FavNsiCook.gcnsi();return n===null?(FavNsiCook.ucnsi(),!0):!1}return!0};n.hic=function(i,r,u){var e=i.isFav,f;e?(t.lfi(i.ns,t.instCl,l(r.id)+"Remove"),t.unsave(r,1,i),f={},f.mid=i.mid,MMMessenger.Post(_w.parent,"Favorite.Remove",f),i.isFav=!i.isFav,n.createInsightsStyleForButtons(u,i.isFav),c()):(t.lfi(i.ns,t.instCl,l(r.id)+"Add"),o(r,1,i,function(n){n&&!n.IsSuccess&&typeof ShowFavErrorMsg!="undefined"&&ShowFavErrorMsg()}),f={},f.mid=i.mid,MMMessenger.Post(_w.parent,"Favorite.Add",f),i.isFav=!i.isFav,n.createInsightsStyleForButtons(u,i.isFav),nt(i,r))};var ht=function(i){var r=sj_et(i);r!=null&&r.tagName=="IMG"&&typeof t.getHoveredElement!="undefined"&&n.hfc(r,t.getHoveredElement())},tt=function(n){while(n){if(i.hc(n.parentNode,u))return!0;n=n.parentElement}return!1},a=function(n){var r=n.parentElement.parentElement,t=sj_ce("span","","favSavdg"),f=v(w);t.appendChild(f);n.appendChild(t);i.ac(r,u)};n.mark=function(n){if(n&&typeof favresources!="undefined"){var t=sj_ce("span","","favAdded");i.sdt(t,3);t.innerHTML=favresources.adtf;n.appendChild(t);_w.setTimeout(function(){it(t)},2e3)}};n.changeDisplayFavoritesButton=function(n,t){var r,u;if(n&&n.length>0)for(r=0;r<n.length;r++)u=i.hc(n[r],"dN"),!u&&t&&i.ac(n[r],"dN"),u&&!t&&i.rc(n[r],"dN")};n.createInsightsStyleForButtons=function(n,t){var f,r,e;if(n.length>0&&typeof favresources!="undefined")for(f="",r=0;r<n.length;r++)t?(i.ac(n[r],u),f=favresources.rff,sj_evt.fire(h,"Saved")):(i.rc(n[r],u),f=favresources.atf,sj_evt.fire(h,"Unsaved")),e=i.gebc("hint",n[r]),e.length>0&&(e[0].innerHTML=f),n[r].title=f,i.ha(n[r],s)&&i.sa(n[r],s,f)};e=function(n){var r=n.parentElement.parentElement,t=i.gebc("favSavdg",n)[0];t&&t.parentNode.removeChild(t);i.rc(r,u)};v=function(n){var t=sj_ce("img","favImg","");return t.src=n,t};o=function(n,u,f,e){var o,h,s;o={};h=f?f.favQ:"";o.query=r?r:h;u==1&&f?(o.query=o.query||"",o.mid=f.mid,o.description=f.title,o.MediaUrl=f.imgUrl,o.SourceUrl=f.pageUrl,o.ThWidth=f.thW,o.ThHeight=f.thH,o.MediaWidth=f.width,o.MediaHeight=f.height,o.MD5=f.md5,o.MediaFormat=f.fmt,o.ThumbnailId=f.thId,o.CollectionType=rt(),o.ContentId=f.ccid):(s=t.gmd(n),o.mid=i.ga(n,"mid"),o.description=i.ga(n,"t1"),s&&(o.ThumbnailId=s.tid,o.MediaUrl=s.imgurl,o.SourceUrl=s.surl,o.ThWidth=s.thW,o.ThHeight=s.thH,o.MediaWidth=s.mw,o.MediaHeight=s.mh,o.MD5=s.md5,o.MediaFormat=s.fmt,o.ContentId=s.cid));t.sxhr(o,1,n,u,e);t.ufcw()};sj_be(_w,"load",k);sj_evt.fire("Favorites.Loaded")}(ImageFavorites||(ImageFavorites={}))