var LoadState,ImageInsightsViewerUtils;(function(n){n[n.Clear=0]="Clear";n[n.Loading=1]="Loading";n[n.Loaded=2]="Loaded"})(LoadState||(LoadState={}));ImageInsightsViewerUtils=function(){function n(n,t,i,r,u,f,e){this.loadState=0;this.utils=pMMUtils;var o=this;this.insightsElement=n;this.insightsErrorElement=t;this.insightsErrorExpectedElement=i;this.loadingClass=r;this.currentInfo=u;this.tryViewPage=f;this.loadState=e;SmartEvent.bindc(10,function(){o.handleInsightsLoaded()})}return n.prototype.UpdateCurrentInfo=function(n){this.currentInfo=n},n.prototype.FetchInsights=function(n,t){this.setLoadState(1);var r=InsightsLogger.CreateAndStart(),i=this;this.lastRequest=InsightsFetcher.fetch(n,!1,function(n,u){i.onContentLoadEvent(n,u,r,t)},function(n){i.onContentLoadError(n,t)},function(){i.onNoInsightsData(t)})},n.prototype.setLoadState=function(n){this.loadState=n;n==0||n==2?this.utils.rc(this.insightsElement,this.loadingClass):this.utils.ac(this.insightsElement,this.loadingClass)},n.prototype.getLoadState=function(){return this.loadState},n.prototype.handleInsightsLoaded=function(){var n=this;n.insightsElement.firstChild&&this.utils.sv(n.insightsElement.firstChild,"visible")},n.prototype.onContentLoadEvent=function(n,t,i,r){if((this.currentInfo==null||r==null||this.currentInfo.index==r)&&n&&n.indexOf("insights")!=-1){this.clearInsightsContent();this.setLoadState(2);var u=sj_ce("div");sj_appHTML(u,n);i.logResponseReceived();i.initializeImageLogging(u);this.insightsElement.appendChild(u);typeof rms!="undefined"&&rms.start();i.logResponseAppended()}},n.prototype.onContentLoadError=function(n,t){this.currentInfo!=null&&(t==null||this.currentInfo.index==t)&&(this.clearInsightsContent(),this.insightsErrorElement&&this.insightsElement.appendChild(this.insightsErrorElement))},n.prototype.onNoInsightsData=function(n){this.currentInfo!=null&&(n==null||this.currentInfo.index==n)&&(this.clearInsightsContent(),this.insightsErrorExpectedElement&&this.currentInfo.resultData&&(this.tryViewPage&&(this.tryViewPage.href=this.currentInfo.resultData.pageUrl,this.utils.sdt(this.tryViewPage,this.currentInfo.resultData.pageUrl?4:0)),this.insightsElement.appendChild(this.insightsErrorExpectedElement)))},n.prototype.clearInsightsContent=function(){while(this.insightsElement.firstChild)this.insightsElement.removeChild(this.insightsElement.firstChild);this.setLoadState(0)},n.prototype.cancelLastRequest=function(){this.lastRequest&&(this.lastRequest.abort(),this.lastRequest=null)},n.Create=function(t,i,r,u,f,e,o){return o===void 0&&(o=0),new n(t,i,r,u,f,e,o)},n}()